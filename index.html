<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recepci√≥n de Emergencia - Consulta FUA v2.2</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
    :root {
        --primary-color: #0A2A43; 
        --accent-color: #D4AF37;  
        --text-color-light: #FFFFFF;
        --background-color: #f0f2f5; 
        --success-color: #28a745;
    }
    body { 
        margin: 0; 
        font-family: 'Inter', sans-serif; 
        background: var(--background-color ); 
        display: flex; 
        justify-content: center; 
        align-items: center; 
        min-height: 100vh; 
        overflow: hidden; 
    }
    .mobile-container { 
        width: 390px; 
        height: 700px; 
        position: relative; 
        overflow: hidden; 
        border-radius: 45px; 
        box-shadow: 0 15px 40px rgba(0,0,0,0.25); 
        background: #ffffff; 
        border: 12px solid #fff; 
    }
    
    /* --- Vistas de Pantalla Completa (Login, Admin, etc.) --- */
    .fullscreen-view { 
        position: absolute; 
        top: 0; left: 0; right: 0; bottom: 0; 
        background: var(--background-color); 
        z-index: 20; 
        display: flex; 
        flex-direction: column; 
        justify-content: center; 
        align-items: center; 
        padding: 20px; 
        box-sizing: border-box; 
        transition: opacity 0.3s, transform 0.3s; 
    }
    .fullscreen-view.hidden { 
        opacity: 0; 
        pointer-events: none; 
        transform: scale(0.95); 
    }
    .login-box { 
        width: 100%; 
        max-width: 320px; 
        padding: 30px; 
        background: white; 
        border-radius: 20px; 
        box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
        text-align: center; 
    }
    .login-box h2 { 
        color: var(--primary-color); 
        margin-top: 0; 
    }
    .login-box button { 
        width: 100%; 
        padding: 15px; 
        border: none; 
        border-radius: 10px; 
        font-size: 18px; 
        font-weight: 600; 
        cursor: pointer; 
    }
    .btn-primary { 
        background: var(--primary-color); 
        color: white; 
    }
    .btn-secondary { 
        background: none; 
        color: var(--primary-color); 
        margin-top: 10px; 
    }

    /* --- CORRECCI√ìN: Contenedor y Estilos para el Ojo de Contrase√±a --- */
    .password-wrapper {
        position: relative;
        display: flex;
        align-items: center;
        width: 100%;
        margin-bottom: 15px;
    }
    .password-wrapper input {
        width: 100%;
        padding: 15px;
        padding-right: 50px; /* Espacio para el √≠cono */
        border: 1px solid #ccc;
        border-radius: 10px;
        box-sizing: border-box;
        font-size: 16px;
    }
    .toggle-password {
        position: absolute;
        right: 15px;
        background: none;
        border: none;
        cursor: pointer;
        opacity: 0.5;
        z-index: 2;
    }
    
    /* --- Estructura Principal de la App --- */
    #main-app.hidden { display: none; }
    .header { 
        position: absolute; top: 0; left: 0; right: 0; height: 90px; 
        background: var(--primary-color); z-index: 5; display: flex; 
        justify-content: center; align-items: center; 
    }
    .header-title { color: var(--text-color-light); font-size: 24px; font-weight: bold; }
    
    #assistant-video { 
        position: absolute; bottom: 30px; height: 85%; z-index: 1; 
        transition: all 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55); 
        object-fit: cover; object-position: center top; 
    }
    #assistant-video.initial-state { right: 50%; transform: translateX(50%); height: 90%; }
    #assistant-video.side-state { right: -40px; transform: translateX(0); }
    #assistant-video.chat-mode-state { right: 50%; transform: translateX(50%); height: 95%; }
    
    .menu-button { 
        position: absolute; left: 25px; z-index: 10; background: var(--primary-color); 
        border: 2px solid var(--accent-color); border-radius: 30px; padding: 15px 25px; 
        font-size: 16px; font-weight: 600; color: var(--text-color-light); cursor: pointer; 
        min-width: 180px; opacity: 0; transform: translateX(-30px); pointer-events: none; transition: all 0.4s; 
    }
    .menu-button.visible { opacity: 1; transform: translateX(0); pointer-events: auto; }
    #btn-buscar { top: 120px; transition-delay: 0.2s; }
    #btn-observados { top: 190px; transition-delay: 0.3s; }
    #btn-admin { top: 260px; transition-delay: 0.4s; }
    #btn-info { top: 330px; transition-delay: 0.5s; }
    #btn-contacto { top: 400px; transition-delay: 0.6s; }

    /* --- Modo Chat --- */
    #chat-view { position: absolute; bottom: 10px; left: 10px; right: 10px; z-index: 15; }
    .chat-log { max-height: 150px; overflow-y: auto; margin-bottom: 10px; }
    .chat-message { margin-bottom: 10px; padding: 10px 15px; border-radius: 15px; max-width: 80%; }
    .user-message { background: var(--primary-color); color: white; align-self: flex-end; margin-left: auto; }
    .ia-message { background: #e9e9eb; color: #333; align-self: flex-start; }
    .input-bar { display: flex; align-items: center; background: white; border-radius: 30px; padding: 5px 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
    #text-input { flex-grow: 1; border: none; background: none; outline: none; padding: 10px; font-size: 16px; }
    
    /* --- Estilos Panel Admin --- */
    #admin-view .btn-primary { margin-top: 20px; }
    .user-list { width: 100%; list-style: none; padding: 0; max-height: 300px; overflow-y: auto; }
    .user-list li { background: #f8f9fa; padding: 10px 15px; border-radius: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
    .switch { position: relative; display: inline-block; width: 50px; height: 24px; }
    .switch input { opacity: 0; width: 0; height: 0; }
    .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
    .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
    input:checked + .slider { background-color: var(--success-color); }
    input:checked + .slider:before { transform: translateX(26px); }
</style>
</head>
<body>

    <div class="mobile-container">
        <!-- VISTA DE LOGIN/REGISTRO -->
        <div id="login-view" class="fullscreen-view">
            <div class="login-box">
                <h2>Bienvenido</h2>
                <input type="text" id="username" placeholder="Usuario" style="margin-bottom: 15px;">
                <div class="password-wrapper">
                    <input type="password" id="password" placeholder="Contrase√±a">
                    <button class="toggle-password" onclick="togglePasswordVisibility('password', this)">üëÅÔ∏è</button>
                </div>
                <button class="btn-primary" onclick="handleLogin()">Entrar</button>
                <button class="btn-secondary" onclick="showRegisterView()">Registrarse</button>
            </div>
        </div>
        <div id="register-view" class="fullscreen-view hidden">
            <div class="login-box">
                <h2>Crear Cuenta</h2>
                <input type="text" id="reg-name" placeholder="Nombre Completo" style="margin-bottom: 15px;">
                <div class="password-wrapper">
                    <input type="password" id="reg-password" placeholder="Contrase√±a">
                    <button class="toggle-password" onclick="togglePasswordVisibility('reg-password', this)">üëÅÔ∏è</button>
                </div>
                <input type="email" id="reg-email" placeholder="Correo Electr√≥nico" style="margin-bottom: 15px;">
                <input type="tel" id="reg-phone" placeholder="Tel√©fono (WhatsApp)" style="margin-bottom: 15px;">
                <button class="btn-primary" onclick="handleRegister()">Registrar</button>
                <button class="btn-secondary" onclick="showLoginView()">Volver al Inicio</button>
            </div>
        </div>

        <!-- APLICACI√ìN PRINCIPAL -->
        <div id="main-app" class="hidden">
            <header id="main-header" class="header">
                <div id="header-title" class="header-title">Recepci√≥n Emergencia</div>
            </header>
            
            <video id="assistant-video" class="initial-state" autoplay muted loop playsinline>
                <source src="https://github.com/Dafon1981/recepcion/blob/main/eee.mp4?raw=true" type="video/mp4">
            </video>

            <button id="btn-buscar" class="menu-button" onclick="handleMenuClick('Buscar' )">Buscar FUA</button>
            <button id="btn-observados" class="menu-button" onclick="handleMenuClick('Observados')">Ver Observados</button>
            <button id="btn-admin" class="menu-button" onclick="handleMenuClick('Admin')">Administrar</button>
            <button id="btn-info" class="menu-button" onclick="handleMenuClick('Info')">Informaci√≥n</button>
            <button id="btn-contacto" class="menu-button" onclick="handleMenuClick('Contacto')">Contacto</button>

            <div id="chat-view">
                <div class="chat-log" id="chat-log"></div>
                <div class="input-bar">
                     <input type="text" id="text-input" placeholder="Haz una consulta..." onkeydown="if(event.key==='Enter') handleSend()">
                </div>
            </div>
        </div>

        <!-- VISTAS DE OVERLAY (ADMIN, INGRESO, ETC.) -->
        <div id="admin-view" class="fullscreen-view hidden">
            <div class="login-box">
                <h2>Panel de Administraci√≥n</h2>
                <p>Gestiona los usuarios pendientes de activaci√≥n.</p>
                <ul class="user-list" id="user-list-container"></ul>
                <button class="btn-primary" onclick="showPasswordPrompt('ingreso')">Ingresar Nuevos FUAs</button>
                <button class="btn-secondary" onclick="closeAdminView()">Cerrar Panel</button>
            </div>
        </div>
        <div id="password-prompt" class="fullscreen-view hidden">
             <!-- Este div se llenar√° din√°micamente con JS -->
        </div>
    </div>

<script>
    // --- ESTADO Y SIMULACI√ìN DE BD ---
    let currentUser = null;
    const OPENROUTER_API_KEY = "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";
    let db_users = [
        { id: 1, name: 'manuel', email: 'admin@example.com', password: 'mutter', phone: '999888777', is_validated: true, role: 'admin' },
        { id: 2, name: 'Ana Lopez', email: 'ana@example.com', password: '123', phone: '987654321', is_validated: false, role: 'user' }
    ];

    // --- REFERENCIAS AL DOM ---
    const loginView = document.getElementById('login-view');
    const registerView = document.getElementById('register-view');
    const mainApp = document.getElementById('main-app');
    const adminView = document.getElementById('admin-view');
    const passwordPrompt = document.getElementById('password-prompt');
    const assistantVideo = document.getElementById('assistant-video');
    const menuButtons = document.querySelectorAll('.menu-button');

    // --- L√ìGICA DE VISIBILIDAD ---
    function showLoginView() { registerView.classList.add('hidden'); loginView.classList.remove('hidden'); }
    function showRegisterView() { loginView.classList.add('hidden'); registerView.classList.remove('hidden'); }
    function showAdminView() { adminView.classList.remove('hidden'); loadUsersToAdminPanel(); }
    function closeAdminView() { adminView.classList.add('hidden'); }
    
    function togglePasswordVisibility(inputId, button) {
        const input = document.getElementById(inputId);
        const isPassword = input.type === 'password';
        input.type = isPassword ? 'text' : 'password';
        button.textContent = isPassword ? 'üôà' : 'üëÅÔ∏è';
    }

    // --- L√ìGICA DE LOGIN Y APP ---
    function handleLogin() {
        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value.trim();
        
        const user = db_users.find(u => u.name === username && u.password === password);
        if (user) {
            if (user.is_validated) {
                currentUser = user;
                initApp();
            } else {
                alert("Tu cuenta a√∫n no ha sido validada por un administrador.");
            }
        } else {
            alert("Usuario o contrase√±a incorrectos.");
        }
    }

    function handleRegister() {
        alert(`Registro simulado. Se ha enviado una notificaci√≥n al administrador.`);
        showLoginView();
    }

    function initApp() {
        loginView.classList.add('hidden');
        mainApp.classList.remove('hidden');
        
        setTimeout(() => {
            assistantVideo.classList.remove('initial-state');
            assistantVideo.classList.add('side-state');
            menuButtons.forEach(button => {
                if (button.id === 'btn-admin' && currentUser.role !== 'admin') {
                    button.style.display = 'none';
                } else {
                    button.classList.add('visible');
                }
            });
        }, 1500);

        const chatLog = document.getElementById('chat-log');
        const hour = new Date().getHours();
        let greeting = (hour < 12) ? 'Buenos d√≠as' : (hour < 18) ? 'Buenas tardes' : 'Buenas noches';
        chatLog.innerHTML = `<div class="ia-message">${greeting}, ${currentUser.name}. ¬øEn qu√© puedo ayudarte?</div>`;
    }

    function handleMenuClick(section) {
        if (section === 'Admin') {
            showAdminView();
        } else {
            alert(`Navegando a la secci√≥n: ${section}. (Funcionalidad por implementar)`);
        }
    }
    
    // --- L√ìGICA DEL PANEL DE ADMIN ---
    function loadUsersToAdminPanel() {
        const container = document.getElementById('user-list-container');
        container.innerHTML = '';
        db_users.filter(u => u.role !== 'admin').forEach(user => {
            const li = document.createElement('li');
            li.innerHTML = `
                <div>
                    <strong>${user.name}</strong>  

                    <small><a href="https://wa.me/51${user.phone}" target="_blank" style="color: var(--primary-color );">Contactar por WhatsApp</a></small>
                </div>
                <label class="switch">
                    <input type="checkbox" ${user.is_validated ? 'checked' : ''} onchange="toggleUserValidation(${user.id})">
                    <span class="slider"></span>
                </label>
            `;
            container.appendChild(li);
        });
    }

    function toggleUserValidation(userId) {
        const user = db_users.find(u => u.id === userId);
        user.is_validated = !user.is_validated;
        alert(`El usuario ${user.name} ahora est√° ${user.is_validated ? 'ACTIVADO' : 'DESACTIVADO'}.`);
    }

    function showPasswordPrompt(action) {
        passwordPrompt.innerHTML = `
            <div class="login-box">
                <h3>Acceso a ${action === 'ingreso' ? 'Ingresos' : 'Acci√≥n'}</h3>
                <div class="password-wrapper">
                    <input type="password" id="prompt-password" placeholder="Contrase√±a de acceso">
                    <button class="toggle-password" onclick="togglePasswordVisibility('prompt-password', this)">üëÅÔ∏è</button>
                </div>
                <button class="btn-primary" onclick="checkPassword('${action}')">Acceder</button>
                <button class="btn-secondary" onclick="closePasswordPrompt()">Cancelar</button>
            </div>
        `;
        passwordPrompt.classList.remove('hidden');
    }

    function closePasswordPrompt() {
        passwordPrompt.classList.add('hidden');
    }

    function checkPassword(action) {
        const pass = document.getElementById('prompt-password').value;
        if (action === 'ingreso' && pass === '123456789') {
            closePasswordPrompt();
            alert("Acceso concedido. Mostrando formulario de ingreso de FUAs... (Funcionalidad por implementar)");
        } else {
            alert("Contrase√±a incorrecta.");
        }
    }

</script>
</body>
</html>
